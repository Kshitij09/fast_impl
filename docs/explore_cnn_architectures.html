---

title: Tutorial- Exploring wide range of CNN architectures

keywords: fastai
sidebar: home_sidebar

summary: "We'll be exploring CNN architectures from torchvision, fastai2 and [pytorch-image-models](https://github.com/rwightman/pytorch-image-models) (timm)"
description: "We'll be exploring CNN architectures from torchvision, fastai2 and [pytorch-image-models](https://github.com/rwightman/pytorch-image-models) (timm)"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/01_explore_cnn_architectures.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai2.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fast_impl.core</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><a href="/fast_impl/core#arch_summary"><code>arch_summary</code></a> function plays major role while deciding parameter groups for discriminative learning. It gives a brief summary of architecture and is independant of <code>DataLoaders</code> or <code>Learner</code>. Thus we could use this function to assess the correctness of architecture before passing it to learner.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="fastai2-models">fastai2 models<a class="anchor-link" href="#fastai2-models"> </a></h2><p>Let's first quickly go through <code>XResNet</code> series offered by <code>fastai2</code></p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">xresnet18</span> <span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">_xresnet</span><span class="p">(</span><span class="n">pretrained</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span>  <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">arch_summary</span><span class="p">(</span><span class="n">xresnet18</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(0 ) ConvLayer        : 3   layers
(1 ) ConvLayer        : 3   layers
(2 ) ConvLayer        : 3   layers
(3 ) MaxPool2d        : 1   layers
(4 ) Sequential       : 2   layers
(5 ) Sequential       : 2   layers
(6 ) Sequential       : 2   layers
(7 ) Sequential       : 2   layers
(8 ) AdaptiveAvgPool2d: 1   layers
(9 ) Flatten          : 1   layers
(10) Dropout          : 1   layers
(11) Linear           : 1   layers
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Look at the Sequential layers from 4-7 all having two child layers, that's the meaning of <code>[2,2,2,2]</code> in the model definition. Let's go deeper and check what are those children</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">arch_summary</span><span class="p">(</span><span class="n">xresnet18</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(0 ) ConvLayer        : 3   layers
      Conv2d
      BatchNorm2d
      ReLU
(1 ) ConvLayer        : 3   layers
      Conv2d
      BatchNorm2d
      ReLU
(2 ) ConvLayer        : 3   layers
      Conv2d
      BatchNorm2d
      ReLU
(3 ) MaxPool2d        : 1   layers
(4 ) Sequential       : 2   layers
      ResBlock
      ResBlock
(5 ) Sequential       : 2   layers
      ResBlock
      ResBlock
(6 ) Sequential       : 2   layers
      ResBlock
      ResBlock
(7 ) Sequential       : 2   layers
      ResBlock
      ResBlock
(8 ) AdaptiveAvgPool2d: 1   layers
(9 ) Flatten          : 1   layers
(10) Dropout          : 1   layers
(11) Linear           : 1   layers
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>hmm... those are indeed <code>ResBlocks</code>, but what is <code>ResBlock</code>?</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">arch_summary</span><span class="p">(</span><span class="n">xresnet18</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(0 ) Sequential       : 2   layers
      ConvLayer
      ConvLayer
(1 ) Sequential       : 0   layers
(2 ) ReLU             : 1   layers
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/fast_impl/images/residual_block.png" alt="Residual Block"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>According to <a href="https://arxiv.org/abs/1512.03385">ResNet</a>, we should have two weight layers, an identity (skip-connection) block and activation (ReLU), which is exactly <code>ResBlock</code> implements, with many <a href="https://arxiv.org/abs/1812.01187">tweaks</a> introduced in the following years to improve the performance. A <code>ConvLayer</code> in fastai is basically Conv2D --&gt; BatchNorm --&gt; Activation (ReLU) but we can infinitely customize this building block; you might want to have a look at its <a href="https://github.com/fastai/fastai2/blob/a1204f7ba005fe92e09763f2b68dd9fb4ef11846/fastai2/layers.py#L230">implementation</a>. For rest of <code>xresnet</code> family, we'll have the exact same architecture but with more "groups" of <code>ResBlock</code>, such as</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">xresnet34</span> <span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">_xresnet</span><span class="p">(</span><span class="n">pretrained</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xresnet50</span> <span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">_xresnet</span><span class="p">(</span><span class="n">pretrained</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span>  <span class="mi">6</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xresnet101</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">_xresnet</span><span class="p">(</span><span class="n">pretrained</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">xresnet152</span><span class="p">(</span><span class="n">pretrained</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">return</span> <span class="n">_xresnet</span><span class="p">(</span><span class="n">pretrained</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
<p><code>xresnet34</code> will have 4 groups having <code>[3, 4, 6, 3]</code> no. of <code>ResBlocks</code> and so on. We do get other variants of these base architecutures but as they're still experimental, I'll skip them for now. Now let's have a look at some architectures from torchvision. I've already explained <code>densenet121</code> in <a href="core.ipynb">core</a> notebook</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="torchvision-models">torchvision models<a class="anchor-link" href="#torchvision-models"> </a></h2>
</div>
</div>
</div>
</div>
 

