---

title: Tutorial - Data Wrangling with fastai2

keywords: fastai
sidebar: home_sidebar

summary: "In this tutorial, we'll work on 'Stanford-Dogs' Dataset which is a subset of Imagenet, considered for fine-grained classification. We'll work on extracting labels from path, transforming it to breed names for understandability and performing train/val/test splits"
description: "In this tutorial, we'll work on 'Stanford-Dogs' Dataset which is a subset of Imagenet, considered for fine-grained classification. We'll work on extracting labels from path, transforming it to breed names for understandability and performing train/val/test splits"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_tutorial.stanford_dogs_wrangling.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Download-and-set-up-dataset">Download and set up dataset<a class="anchor-link" href="#Download-and-set-up-dataset"> </a></h1><p>I'll be using Kaggle <a href="https://www.kaggle.com/jessicali9530/stanford-dogs-dataset/data">dataset</a> for the same. You should have Kaggle's CLI installed and put your kaggle.json file in <code>~/.kaggle</code> directory (or <code>/root/.kaggle</code> if on colab).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>kaggle datasets download -d jessicali9530/stanford-dogs-dataset -p data
<span class="o">!</span><span class="nb">cd</span> data <span class="o">&amp;&amp;</span> mkdir stanford-dogs <span class="o">&amp;&amp;</span><span class="err">\</span>
 <span class="n">unzip</span> <span class="o">-</span><span class="n">qq</span> <span class="n">stanford</span><span class="o">-</span><span class="n">dogs</span><span class="o">-</span><span class="n">dataset</span><span class="o">.</span><span class="n">zip</span> <span class="o">-</span><span class="n">d</span> <span class="n">stanford</span><span class="o">-</span><span class="n">dogs</span> <span class="o">&amp;&amp;</span>\
 <span class="n">rm</span> <span class="o">-</span><span class="n">rf</span> <span class="n">stanford</span><span class="o">-</span><span class="n">dogs</span><span class="o">-</span><span class="n">dataset</span><span class="o">.</span><span class="n">zip</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Downloading stanford-dogs-dataset.zip to data
 98% 737M/750M [00:09&lt;00:00, 79.2MB/s]
100% 750M/750M [00:09&lt;00:00, 80.3MB/s]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Removing unnecessary hierarchy</span>
<span class="o">%</span><span class="k">cd</span> data
<span class="o">!</span>mv stanford-dogs/annotations/Annotation stanford-dogs/images/Images stanford-dogs
<span class="o">!</span>rm -rf stanford-dogs/annotations stanford-dogs/images
<span class="o">%</span><span class="k">cd</span> /content
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># train/test splits</span>
<span class="o">!</span>wget http://vision.stanford.edu/aditya86/ImageNetDogs/lists.tar 
<span class="o">!</span>tar -xf lists.tar test_list.mat <span class="o">&amp;&amp;</span> rm -rf lists.tar
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Explore-Dataset">Explore Dataset<a class="anchor-link" href="#Explore-Dataset"> </a></h1><p>Goal of this section is to figure out way to label the images with breed names, splitting dataset into train/test and applying K-fold on train set.</p>
<p>Expected distribution at the end:</p>
<p>Train: 9000</p>
<p>Val: 3000</p>
<p>Test: 8000</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">fastai2.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastai2.data.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">fastprogress</span> <span class="kn">import</span> <span class="n">progress_bar</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">loadmat</span>
<span class="n">test_list</span> <span class="o">=</span> <span class="n">loadmat</span><span class="p">(</span><span class="s1">&#39;test_list.mat&#39;</span><span class="p">);</span> 

<span class="n">base</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/stanford-dogs/Images&#39;</span><span class="p">)</span>
<span class="n">test_fns</span> <span class="o">=</span><span class="p">[</span><span class="n">base</span><span class="o">/</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">test_list</span><span class="p">[</span><span class="s1">&#39;file_list&#39;</span><span class="p">]]</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;data/stanford-dogs&#39;</span><span class="p">)</span>
<span class="n">fnames</span> <span class="o">=</span> <span class="n">get_image_files</span><span class="p">(</span><span class="n">path</span><span class="o">/</span><span class="s1">&#39;Images&#39;</span><span class="p">);</span> <span class="n">fnames</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Keeping test images aside for benchmark, will split train set into train/val</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">train_fns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">fnames</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">test_fns</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Stratified-KFold">Stratified KFold<a class="anchor-link" href="#Stratified-KFold"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Following steps are performed:</p>
<ol>
<li>From all the directory names, we build a <code>vocab</code> of classes involved</li>
<li>Then we pass this <code>vocab</code> to <code>CategoryMap</code> to get <code>o2i</code> mapping</li>
<li>A Pipeline written to go from full path to its <code>label</code> (integer)</li>
<li>Procedding with StratifiedKFold where <code>X</code> is the file names and <code>y</code> is repective integer label</li>
</ol>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># split on &#39;-&#39; for once, 1st part will be key and 2nd value</span>
<span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s2">&quot;n02098105-soft-coated_wheaten_terrier&quot;</span><span class="p">,</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;n02098105&#39;, &#39;soft-coated_wheaten_terrier&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">impath</span> <span class="o">=</span> <span class="n">path</span><span class="o">/</span><span class="s1">&#39;Images&#39;</span><span class="p">;</span> 
<span class="n">dirs</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">impath</span><span class="o">.</span><span class="n">ls</span><span class="p">())</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">));</span> 

<span class="n">id2label</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>
<span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
  <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="n">id2label</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span>

<span class="n">id2label</span><span class="p">[</span><span class="s2">&quot;n02098105&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;soft-coated_wheaten_terrier&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_lbl</span><span class="p">(</span><span class="n">o</span><span class="p">):</span> <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">o</span><span class="p">),</span><span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="n">dirs</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">get_lbl</span><span class="p">);</span> <span class="n">vocab</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(#120) [&#39;n02111277&#39;,&#39;n02097130&#39;,&#39;n02105251&#39;,&#39;n02110063&#39;,&#39;n02085936&#39;,&#39;n02115641&#39;,&#39;n02112018&#39;,&#39;n02099601&#39;,&#39;n02092002&#39;,&#39;n02098286&#39;...]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">catm</span> <span class="o">=</span> <span class="n">CategoryMap</span><span class="p">(</span><span class="n">vocab</span><span class="p">,</span><span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> 
<span class="c1"># to check the mapping</span>
<span class="c1">#print(catm.o2i)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">train_fns</span><span class="p">)</span>
<span class="n">ypipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span><span class="n">RegexLabeller</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;/(\w+)_\d+.jpg$&#39;</span><span class="p">),</span> <span class="n">catm</span><span class="o">.</span><span class="n">o2i</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">])</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">array</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">train_fns</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ypipe</span><span class="p">))</span>
<span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">catm</span><span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(Path(&#39;data/stanford-dogs/Images/n02092002-Scottish_deerhound/n02092002_6114.jpg&#39;),
 8,
 &#39;n02092002&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>ypipe</code> transforms filepath to index while <code>catm</code> transforms indices back to labels (class_id)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Labelling">Labelling<a class="anchor-link" href="#Labelling"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We'll group a part between '/' and '_' (at the end of string). This will give us imagenet id for that class, We can use <code>id2label</code> created earlier to map those ids to breed names</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/(\w+)_\d+.jpg$&quot;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">pat</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">train_fns</span><span class="p">[</span><span class="mi">105</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Path: </span><span class="si">{</span><span class="n">train_fns</span><span class="p">[</span><span class="mi">105</span><span class="p">]</span><span class="si">}</span><span class="se">\n</span><span class="s2">Label: </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">Breed: </span><span class="si">{</span><span class="n">id2label</span><span class="p">[</span><span class="n">res</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Path: data/stanford-dogs/Images/n02110063-malamute/n02110063_16539.jpg
Label: n02110063
Breed: malamute
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A csv would be great way to represent all the details associated with each example, including its fold_idx</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">labeller</span> <span class="o">=</span> <span class="n">RegexLabeller</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;/(\w+)_\d+.jpg$&quot;</span><span class="p">)</span>
<span class="n">lbl_pipe</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">([</span><span class="n">labeller</span><span class="p">,</span> <span class="n">id2label</span><span class="o">.</span><span class="fm">__getitem__</span><span class="p">])</span>
<span class="n">lbl_pipe</span><span class="p">(</span><span class="n">fnames</span><span class="p">[</span><span class="mi">10</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Newfoundland&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">train_fns</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">lbl_pipe</span><span class="p">)</span>
<span class="n">class_ids</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">train_fns</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">labeller</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we have everything needed to create a csv file with Stratified k-folds.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="n">skf</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span><span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">random_state</span><span class="o">=</span><span class="mi">47</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;image_path&#39;</span><span class="p">:</span> <span class="n">train_fns</span><span class="p">,</span> 
                   <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">class_ids</span><span class="p">),</span>
                   <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">labels</span><span class="p">)})</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">val_idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">skf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">y</span><span class="p">)):</span> 
  <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">val_idx</span><span class="p">,</span><span class="s1">&#39;fold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>image_path</th>
      <th>class_id</th>
      <th>label</th>
      <th>fold</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>data/stanford-dogs/Images/n02092002-Scottish_deerhound/n02092002_6114.jpg</td>
      <td>n02092002</td>
      <td>Scottish_deerhound</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>data/stanford-dogs/Images/n02092339-Weimaraner/n02092339_514.jpg</td>
      <td>n02092339</td>
      <td>Weimaraner</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>data/stanford-dogs/Images/n02096437-Dandie_Dinmont/n02096437_2267.jpg</td>
      <td>n02096437</td>
      <td>Dandie_Dinmont</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>data/stanford-dogs/Images/n02107683-Bernese_mountain_dog/n02107683_4016.jpg</td>
      <td>n02107683</td>
      <td>Bernese_mountain_dog</td>
      <td>3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>data/stanford-dogs/Images/n02111277-Newfoundland/n02111277_14330.jpg</td>
      <td>n02111277</td>
      <td>Newfoundland</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;train.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_lbls</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">test_fns</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">lbl_pipe</span><span class="p">)</span>
<span class="n">test_y</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">test_fns</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">ypipe</span><span class="p">)</span>
<span class="n">test_cls_ids</span> <span class="o">=</span> <span class="n">L</span><span class="p">(</span><span class="n">test_fns</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">labeller</span><span class="p">)</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;image_path&#39;</span><span class="p">:</span> <span class="n">test_fns</span><span class="p">,</span>
                        <span class="s1">&#39;class_id&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_cls_ids</span><span class="p">),</span>
                        <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_lbls</span><span class="p">),</span>
                        <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">test_y</span><span class="p">)})</span>
<span class="n">test_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>image_path</th>
      <th>class_id</th>
      <th>label</th>
      <th>y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>data/stanford-dogs/Images/n02085620-Chihuahua/n02085620_2650.jpg</td>
      <td>n02085620</td>
      <td>Chihuahua</td>
      <td>24</td>
    </tr>
    <tr>
      <th>1</th>
      <td>data/stanford-dogs/Images/n02085620-Chihuahua/n02085620_4919.jpg</td>
      <td>n02085620</td>
      <td>Chihuahua</td>
      <td>24</td>
    </tr>
    <tr>
      <th>2</th>
      <td>data/stanford-dogs/Images/n02085620-Chihuahua/n02085620_1765.jpg</td>
      <td>n02085620</td>
      <td>Chihuahua</td>
      <td>24</td>
    </tr>
    <tr>
      <th>3</th>
      <td>data/stanford-dogs/Images/n02085620-Chihuahua/n02085620_3006.jpg</td>
      <td>n02085620</td>
      <td>Chihuahua</td>
      <td>24</td>
    </tr>
    <tr>
      <th>4</th>
      <td>data/stanford-dogs/Images/n02085620-Chihuahua/n02085620_1492.jpg</td>
      <td>n02085620</td>
      <td>Chihuahua</td>
      <td>24</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;test.csv&#39;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>At this point, you have two csv files:</p>
<ol>
<li>train.csv: Labelled and Stratified K Fold on training examples (12000)</li>
<li>test.csv: Test dataset from given test file names</li>
</ol>

</div>
</div>
</div>
</div>
 

